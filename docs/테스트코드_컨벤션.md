## 1. **í…ŒìŠ¤íŠ¸ ë ˆë²¨ ì •ì˜ (Layering ê¸°ì¤€)**

| ë ˆë²¨ | ëª©ì  | í¬í•¨ ëŒ€ìƒ | ì˜ì¡´ì„± |
| --- | --- | --- | --- |
| **Unit Test** | í´ë˜ìŠ¤ ë‹¨ìœ„ ë¡œì§ ê²€ì¦ | Service, Domain | DB/Network ì—†ìŒ (Mock) |
| **Slice Test** | ìŠ¤í”„ë§ ë ˆì´ì–´ë³„ ê²€ì¦ | `@WebMvcTest`, `@DataJpaTest` | í•„ìš” ë¶€ë¶„ë§Œ ë¡œë”© |
| **Integration Test** | ì‹œìŠ¤í…œ í†µí•© ê²€ì¦ | Controller~DB íë¦„ | ì‹¤ì œ DB/Testcontainers |
| **E2E Test** | ì™¸ë¶€ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ | API íë¦„ ì „ì²´ | ì‹¤í™˜ê²½ ìœ ì‚¬ êµ¬ì„± |

---

## 2. **í…ŒìŠ¤íŠ¸ ëª…ëª… ê·œì¹™**

### ğŸ”¹ **í´ë˜ìŠ¤ëª…**

```
XxxServiceTest
XxxControllerTest
XxxRepositoryTest
```

### ğŸ”¹Â **ë©”ì„œë“œ ë„¤ì´ë° ì»¨ë²¤ì…˜**

### **1) ìƒí™© + ê²°ê³¼**

```
ì´ë©”ì¼ì´_ì¤‘ë³µì´ë©´_íšŒì›ê°€ì…ì´_ì‹¤íŒ¨í•œë‹¤()
ë¬¸ì œë¥¼_ì²˜ìŒ_í•´ê²°í•˜ë©´_xpê°€_ì§€ê¸‰ëœë‹¤()
```

### **2) ì¡°ê±´ + í–‰ìœ„ + ê¸°ëŒ€ê°’**

```
ì¤‘ë³µëœ_ì´ë©”ì¼ë¡œ_íšŒì›ê°€ì…ì„_ìš”ì²­í•˜ë©´_409ê°€_ë°œìƒí•œë‹¤()
ì²˜ìŒ_ë¬¸ì œ_í•´ê²°ì‹œ_xpê°€_50_ì§€ê¸‰ëœë‹¤()
```

---

## 3. **Given / When / Then êµ¬ì¡°**

```
given// ì¤€ë¹„
when// ì‹¤í–‰
then// ê²€ì¦
```

ì˜ˆì‹œ:

```java
@Test
voidcalculateXP_givenSolvedFirstTime_shouldReturnXP() {
// given
Useruser=newUser();
Problemproblem=newProblem();

// when
intxp= xpService.calculate(user, problem);

// then
    assertThat(xp).isEqualTo(50);
}
```

---

## 4. **Assertion ì»¨ë²¤ì…˜**

ê³µì‹ ê¶Œì¥: **AssertJ**

### ê¶Œì¥

```java
assertThat(result).isEqualTo(...);
assertThat(list).hasSize(3).contains(...);
assertThatThrownBy(() -> service.run()).isInstanceOf(...);
```

### ê¸ˆì§€

```java
assertTrue(...)
assertFalse(...)
assertEquals(...)
```

> ì´ìœ : failure message í‘œí˜„ë ¥ì´ ë‚®ê³  ë””ë²„ê¹…ì´ ì–´ë ¤ì›€
>

---

## 5. **Mockito / Stub / Spy ì „ëµ**

ê¶Œì¥:

| ìƒí™© | ì‚¬ìš© |
| --- | --- |
| ë¡œì§ ê²€ì¦ | `Unit = Mockito` |
| behavior ê²€ì¦ (í˜¸ì¶œ) | `verify()` |
| ìƒíƒœ ê²€ì¦ | Assertions |

ì˜ˆì‹œ:

```java
verify(repository).save(any());
```

ì‹¤ë¬´ ì§€ì¹¨:

- mock/stubì€ **í•œ í…ŒìŠ¤íŠ¸ì— ìµœì†Œ**
- behavior í…ŒìŠ¤íŠ¸ëŠ” ë‚¨ìš© ê¸ˆì§€
- ì‹¤ì œ DB ì“°ì§€ ì•ŠìŒ

---

## 6. **Spring Test Annotation ê·œì¹™**

ê¶Œì¥ ì¡°í•©:

### Unit

```
@ExtendWith(MockitoExtension.class)
```

### Slice í…ŒìŠ¤íŠ¸

```
@DataJpaTest
```

```
@WebMvcTest(controllers = XxxController.class)
```

### Integration

```
@SpringBootTest
@AutoConfigureMockMvc
@Testcontainers
```

---

## 7. **Fixtures & Test Data**

**í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ê·œì¹™**

- í…ŒìŠ¤íŠ¸ê°„ ê³µìœ  ê¸ˆì§€
- Mutable ê°ì²´ëŠ” ë§¤ë²ˆ fresh
- Test Fixture Builder íŒ¨í„´ ê¶Œì¥

ì˜ˆì‹œ:

```java
Useruser = UserTestBuilder.withBasicInfo().build();
```

ë˜ëŠ” record ê¸°ë°˜:

```java
recordUserFixture(...) {}
```

---

## 8. **DB í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜**

ì‹¤ë¬´ ê¸°ì¤€:

- H2 ì‚¬ìš© ì§€ì–‘ (MySQL/PostgreSQLê³¼ ë™ì‘ ì°¨ì´ í¼)
- Testcontainers ê¶Œì¥
- Repository í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ DB ê¸°ë°˜

ì˜ˆì‹œ:

```java
@DataJpaTest
@Testcontainers
classUserRepositoryTest { }
```

---

## 9. **í…ŒìŠ¤íŠ¸ ë…ë¦½ì„± & ê²©ë¦¬**

ì›ì¹™:

- í…ŒìŠ¤íŠ¸ ìˆœì„œ ì˜ì¡´ ê¸ˆì§€
- DB state ê³ ë¦½
- ì‹œê°„/ëœë¤/í™˜ê²½ ì˜ì¡´ ê¸ˆì§€

ì‹œê°„ì€ `Clock` ì£¼ì…

---

## 10. **ì •í•´ì§„ ì‹¤íŒ¨ ê¸°ì¤€**

ì‹¤íŒ¨ ì‹œ íŒë‹¨ ê¸°ì¤€ í†µì¼:

- Exception íƒ€ì…
- ë©”ì‹œì§€
- ìƒíƒœ ë³€í™” ì—†ìŒ
- ì‚¬ì´ë“œì´í™íŠ¸ ì—†ìŒ

ì˜ˆì‹œ:

```java
assertThatThrownBy(...)
    .isInstanceOf(InvalidStateException.class)
    .hasMessageContaining("already solved");
```

---

## 11. **ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€**

ê¶Œì¥ ê¸°ì¤€:

```
Unit = 80%+
Service = 70%+
Controller = ì„ íƒì 
Domain = 90%+
```

---

## 12. **Mock ì „ëµ**

Mocking ì§€ì¹¨:

- DBëŠ” ì ˆëŒ€ mock X (Repository ëª¨í‚¹ì€ smell)
- Cache/External APIë§Œ mock
- Domain ë¡œì§ì€ mock X (ìˆœìˆ˜í•˜ê²Œ í…ŒìŠ¤íŠ¸)

---